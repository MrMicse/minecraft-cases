// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
const tg = window.Telegram?.WebApp;
if (tg) {
    tg.expand();
    tg.BackButton?.hide();
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let userData = {
    balance: 10000,
    inventory: [],
    userId: null,
    username: null
};

let casesData = [];
let inventoryData = [];
let currentCase = null;
let currentItem = null;
let isOpening = false;
let isInitialized = false;

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã
const elements = {
    balance: document.getElementById('user-balance'),
    casesGrid: document.getElementById('cases-grid'),
    itemsTrack: document.getElementById('items-track'),
    inventoryGrid: document.getElementById('inventory-grid'),
    caseModal: document.getElementById('case-modal'),
    inventoryModal: document.getElementById('inventory-modal'),
    resultModal: document.getElementById('result-modal'),
    loadingOverlay: document.getElementById('loading'),
    rouletteContainer: document.getElementById('roulette-container'),
    inventoryBtn: document.getElementById('inventory-btn'),
    closeModal: document.getElementById('close-modal'),
    closeInventory: document.getElementById('close-inventory'),
    closeResult: document.getElementById('close-result'),
    openCaseBtn: document.getElementById('open-case-btn'),
    caseName: document.getElementById('case-name'),
    casePriceValue: document.getElementById('case-price-value'),
    caseDescription: document.getElementById('case-description'),
    openPrice: document.getElementById('open-price'),
    resultItemName: document.getElementById('result-item-name'),
    resultItemRarity: document.getElementById('result-item-rarity'),
    resultItemPrice: document.getElementById('result-item-price'),
    resultItemIcon: document.getElementById('result-icon'),
    newBalance: document.getElementById('new-balance'),
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
async function initApp() {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
    showLoading();
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–µ–π—Å—ã
        casesData = [
            {
                id: 1,
                name: 'üçé –ö–µ–π—Å —Å –ï–¥–æ–π',
                price: 100,
                icon: 'üçé',
                description: '–°–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—É—é –µ–¥—É –∏ –Ω–∞–ø–∏—Ç–∫–∏',
                rarityWeights: { common: 60, uncommon: 40 }
            },
            {
                id: 2,
                name: '‚õèÔ∏è –†–µ—Å—É—Ä—Å–Ω—ã–π –ö–µ–π—Å',
                price: 250,
                icon: '‚õèÔ∏è',
                description: '–†—É–¥—ã, –º–∏–Ω–µ—Ä–∞–ª—ã –∏ –±–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã',
                rarityWeights: { common: 40, uncommon: 50, rare: 10 }
            },
            {
                id: 3,
                name: '‚öîÔ∏è –û—Ä—É–∂–µ–π–Ω—ã–π –ö–µ–π—Å',
                price: 500,
                icon: '‚öîÔ∏è',
                description: '–û—Ä—É–∂–∏–µ, –±—Ä–æ–Ω—è –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã',
                rarityWeights: { uncommon: 30, rare: 50, epic: 20 }
            },
            {
                id: 4,
                name: 'üåü –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ö–µ–π—Å',
                price: 1000,
                icon: 'üåü',
                description: '–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã',
                rarityWeights: { rare: 20, epic: 50, legendary: 30 }
            },
            {
                id: 5,
                name: 'üëë –î–æ—Å—Ç—É–ø–Ω—ã–π –ö–µ–π—Å',
                price: 5000,
                icon: 'üëë',
                description: '–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –¥–æ–Ω–∞—Ç –ø—Ä–µ–¥–º–µ—Ç—ã',
                rarityWeights: { epic: 30, legendary: 70 }
            },
            {
                id: 6,
                name: 'üß∞ –°–ª—É—á–∞–π–Ω—ã–π –ö–µ–π—Å',
                price: 750,
                icon: 'üß∞',
                description: '–ú–∏–∫—Å –∏–∑ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π',
                rarityWeights: { common: 30, uncommon: 40, rare: 20, epic: 10 }
            }
        ];
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await loadUserData();
        
        updateUI();
        isInitialized = true;
        
        console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', {
            balance: userData.balance,
            inventoryCount: inventoryData.length,
            userId: userData.userId
        });
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        loadUserDataFromLocal();
        updateUI();
    }
    
    setTimeout(() => {
        hideLoading();
        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!');
    }, 1000);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function loadUserData() {
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
    
    // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
    const localData = loadUserDataFromLocal();
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å Telegram Web App, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º
    if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
        userData.userId = tg.initDataUnsafe.user.id;
        userData.username = tg.initDataUnsafe.user.username || 
                           tg.initDataUnsafe.user.first_name;
        
        console.log('Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', {
            id: userData.userId,
            username: userData.username
        });
        
        try {
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
            const serverData = await getServerUserData();
            
            if (serverData && serverData.success) {
                console.log('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞:', serverData);
                
                // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                userData.balance = serverData.user.balance || localData.balance || 10000;
                
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏ (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π + –ª–æ–∫–∞–ª—å–Ω—ã–π)
                if (serverData.inventory && serverData.inventory.length > 0) {
                    inventoryData = serverData.inventory;
                } else if (localData.inventory && localData.inventory.length > 0) {
                    inventoryData = localData.inventory;
                }
                
                console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
            } else {
                // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª)');
                userData.balance = localData.balance || 10000;
                inventoryData = localData.inventory || [];
            }
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞:', error);
            // –ü—Ä–∏ –æ—à–∏–±–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            userData.balance = localData.balance || 10000;
            inventoryData = localData.inventory || [];
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ
        saveUserDataToLocal();
        
    } else {
        // –ë–µ–∑ Telegram –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        console.log('Telegram –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
        userData.balance = localData.balance || 10000;
        inventoryData = localData.inventory || [];
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
async function getServerUserData() {
    return new Promise((resolve, reject) => {
        if (!tg) {
            reject(new Error('Telegram Web App –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω'));
            return;
        }
        
        const data = {
            action: 'get_user_data',
            timestamp: Date.now()
        };
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ sendData
        tg.sendData(JSON.stringify(data));
        
        // –û–∂–∏–¥–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞
        const handler = (eventData) => {
            try {
                const parsedData = JSON.parse(eventData);
                if (parsedData.success) {
                    resolve(parsedData);
                } else {
                    reject(new Error(parsedData.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'));
                }
            } catch (error) {
                reject(error);
            }
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
        tg.onEvent('webAppDataReceived', handler);
        
        // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –æ—Ç–≤–µ—Ç–∞
        setTimeout(() => {
            tg.offEvent('webAppDataReceived', handler);
            reject(new Error('–¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞'));
        }, 3000);
    });
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
function loadUserDataFromLocal() {
    try {
        const savedData = localStorage.getItem('minecraft_case_data');
        if (savedData) {
            const data = JSON.parse(savedData);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É—Å—Ç–∞—Ä–µ–ª–∏ –ª–∏ –¥–∞–Ω–Ω—ã–µ (–±–æ–ª—å—à–µ 1 –¥–Ω—è)
            const oneDayAgo = Date.now() - 24 * 60 * 60 * 1000;
            if (data.timestamp && data.timestamp > oneDayAgo) {
                console.log('–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', {
                    balance: data.balance,
                    inventoryCount: data.inventory ? data.inventory.length : 0
                });
                return data;
            } else {
                console.log('–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏');
            }
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
    }
    
    return { balance: 10000, inventory: [] };
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
function saveUserDataToLocal() {
    try {
        const data = {
            balance: userData.balance,
            inventory: inventoryData,
            userId: userData.userId,
            username: userData.username,
            timestamp: Date.now()
        };
        
        localStorage.setItem('minecraft_case_data', JSON.stringify(data));
        console.log('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ:', {
            balance: userData.balance,
            inventoryCount: inventoryData.length
        });
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
    }
}

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
async function syncWithServer() {
    if (!tg || !userData.userId) {
        console.log('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞: –Ω–µ—Ç Telegram –∏–ª–∏ user_id');
        return false;
    }
    
    try {
        const syncData = {
            action: 'sync_user_data',
            data: {
                balance: userData.balance,
                inventory: inventoryData,
                userId: userData.userId,
                username: userData.username
            },
            timestamp: Date.now()
        };
        
        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', {
            balance: userData.balance,
            inventoryCount: inventoryData.length
        });
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Telegram
        tg.sendData(JSON.stringify(syncData));
        
        // –û–∂–∏–¥–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        return new Promise((resolve) => {
            const handler = (eventData) => {
                try {
                    const parsedData = JSON.parse(eventData);
                    if (parsedData.success) {
                        console.log('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞:', parsedData.message);
                        resolve(true);
                    } else {
                        console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', parsedData.error);
                        resolve(false);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
                    resolve(false);
                }
            };
            
            tg.onEvent('webAppDataReceived', handler);
            
            setTimeout(() => {
                tg.offEvent('webAppDataReceived', handler);
                console.log('–¢–∞–π–º–∞—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏');
                resolve(false);
            }, 2000);
        });
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º:', error);
        return false;
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function updateUI() {
    elements.balance.textContent = userData.balance.toLocaleString();
    renderCases();
    renderInventory();
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–µ–π—Å–æ–≤
function renderCases() {
    elements.casesGrid.innerHTML = '';
    
    casesData.forEach((caseItem, index) => {
        const caseCard = document.createElement('div');
        caseCard.className = 'case-card';
        caseCard.dataset.id = caseItem.id;
        caseCard.style.setProperty('--index', index);
        
        const previewItems = getPreviewItems(caseItem);
        
        caseCard.innerHTML = `
            <div class="case-image">
                <div class="case-icon">${caseItem.icon}</div>
                <div class="case-items-preview">
                    ${previewItems.map(item => `<span>${item.icon}</span>`).join('')}
                </div>
            </div>
            <div class="case-info">
                <h3 class="case-name">${caseItem.name}</h3>
                <p class="case-price">${caseItem.price} üíé</p>
                <p class="case-description">${caseItem.description}</p>
            </div>
        `;
        
        caseCard.addEventListener('click', () => openCaseModal(caseItem));
        elements.casesGrid.appendChild(caseCard);
    });
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–µ–≤—å—é –∫–µ–π—Å–∞
function getPreviewItems(caseItem) {
    const allItems = [];
    
    // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏
    const minecraftItems = {
        common: [
            { name: "–ñ–µ–ª–µ–∑–Ω—ã–π –°–ª–∏—Ç–æ–∫", icon: "‚õìÔ∏è", price: 50, description: "–ë–∞–∑–æ–≤—ã–π —Ä–µ—Å—É—Ä—Å –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞" },
            { name: "–£–≥–æ–ª—å", icon: "‚ö´", price: 30, description: "–¢–æ–ø–ª–∏–≤–æ –∏ –∫—Ä–∞—Å–∏—Ç–µ–ª—å" },
            { name: "–Ø–±–ª–æ–∫–æ", icon: "üçé", price: 40, description: "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≥–æ–ª–æ–¥" },
            { name: "–•–ª–µ–±", icon: "üçû", price: 45, description: "–•–æ—Ä–æ—à–∞—è –µ–¥–∞" }
        ],
        uncommon: [
            { name: "–ê–ª–º–∞–∑", icon: "üíé", price: 150, description: "–¶–µ–Ω–Ω—ã–π –º–∏–Ω–µ—Ä–∞–ª" },
            { name: "–ò–∑—É–º—Ä—É–¥", icon: "üü©", price: 200, description: "–¢–æ—Ä–≥–æ–≤–∞—è –≤–∞–ª—é—Ç–∞" },
            { name: "–ñ–µ–ª–µ–∑–Ω–∞—è –ö–∏—Ä–∞—Å–∞", icon: "üõ°Ô∏è", price: 180, description: "–ó–∞—â–∏—Ç–∞ –æ—Ç —É—Ä–æ–Ω–∞" },
            { name: "–ê–ª–º–∞–∑–Ω—ã–π –ú–µ—á", icon: "‚öîÔ∏è", price: 250, description: "–ú–æ—â–Ω–æ–µ –æ—Ä—É–∂–∏–µ" }
        ],
        rare: [
            { name: "–ù–µ–∑–µ—Ä–∏—Ç–æ–≤—ã–π –°–ª–∏—Ç–æ–∫", icon: "üî±", price: 500, description: "–≠–ª–∏—Ç–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª" },
            { name: "–ö–∏—Ä–æ–∫—Ä—ã–ª–æ", icon: "ü™∂", price: 600, description: "–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ" },
            { name: "–≠–ª–∏—Ç—Ä–∞", icon: "üß•", price: 800, description: "–ü–æ–ª–µ—Ç—ã –≤ –º–∏—Ä–µ" }
        ],
        epic: [
            { name: "–¢–æ—Ç–µ–º –ë–µ—Å—Å–º–µ—Ä—Ç–∏—è", icon: "üê¶", price: 1000, description: "–°–ø–∞—Å–µ–Ω–∏–µ –æ—Ç —Å–º–µ—Ä—Ç–∏" },
            { name: "–°–µ—Ä–¥—Ü–µ –ú–æ—Ä—è", icon: "üíô", price: 1200, description: "–†–µ–¥–∫–∞—è —Ä–µ–ª–∏–∫–≤–∏—è" },
            { name: "–ì–æ–ª–æ–≤–∞ –î—Ä–∞–∫–æ–Ω–∞", icon: "üê≤", price: 1500, description: "–¢—Ä–æ—Ñ–µ–π –¥—Ä–∞–∫–æ–Ω–∞" }
        ],
        legendary: [
            { name: "–ö–æ–º–∞–Ω–¥–Ω—ã–π –ë–ª–æ–∫", icon: "üü™", price: 5000, description: "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç" },
            { name: "–ú–µ—á –ù–µ–∑–µ—Ä–∞", icon: "üó°Ô∏è", price: 3000, description: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ –æ—Ä—É–∂–∏–µ" },
            { name: "–ö–æ—Ä–æ–Ω–∞ –í–ª–∞—Å—Ç–∏", icon: "üëë", price: 10000, description: "–ó–Ω–∞–∫ –∞–±—Å–æ–ª—é—Ç–Ω–æ–π –≤–ª–∞—Å—Ç–∏" }
        ]
    };
    
    for (const [rarity, weight] of Object.entries(caseItem.rarityWeights)) {
        if (weight > 0 && minecraftItems[rarity]) {
            allItems.push(...minecraftItems[rarity]);
        }
    }
    
    const count = Math.min(4, allItems.length);
    const shuffledItems = [...allItems].sort(() => Math.random() - 0.5);
    return shuffledItems.slice(0, count);
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∫–µ–π—Å–∞
function openCaseModal(caseItem) {
    currentCase = caseItem;
    
    elements.caseName.textContent = caseItem.name;
    elements.casePriceValue.textContent = caseItem.price;
    elements.openPrice.textContent = caseItem.price;
    elements.caseDescription.textContent = caseItem.description;
    
    if (userData.balance < caseItem.price) {
        elements.openCaseBtn.disabled = true;
        elements.openCaseBtn.innerHTML = '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé';
    } else {
        elements.openCaseBtn.disabled = false;
        elements.openCaseBtn.innerHTML = `‚õèÔ∏è –û—Ç–∫—Ä—ã—Ç—å –∑–∞ ${caseItem.price} üíé`;
    }
    
    showModal(elements.caseModal);
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞
async function openCase() {
    if (!currentCase || isOpening) return;
    
    if (userData.balance < currentCase.price) {
        alert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤!');
        return;
    }
    
    isOpening = true;
    
    // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
    userData.balance -= currentCase.price;
    elements.balance.textContent = userData.balance.toLocaleString();
    
    // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É
    elements.openCaseBtn.disabled = true;
    elements.openCaseBtn.innerHTML = '‚è≥ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è...';
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–¥–º–µ—Ç
    const wonItem = generateWonItem(currentCase);
    currentItem = wonItem;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
    inventoryData.unshift({
        ...wonItem,
        obtained_at: new Date().toISOString()
    });
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
    saveUserDataToLocal();
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º
    const syncSuccess = await syncWithServer();
    
    if (!syncSuccess) {
        console.log('–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º –Ω–µ —É–¥–∞–ª–∞—Å—å');
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    setTimeout(() => {
        showResult(wonItem);
        isOpening = false;
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        if (userData.balance >= currentCase.price) {
            elements.openCaseBtn.disabled = false;
            elements.openCaseBtn.innerHTML = `‚õèÔ∏è –û—Ç–∫—Ä—ã—Ç—å –∑–∞ ${currentCase.price} üíé`;
        } else {
            elements.openCaseBtn.disabled = true;
            elements.openCaseBtn.innerHTML = '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé';
        }
    }, 1500);
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
function generateWonItem(caseItem) {
    const minecraftItems = {
        common: [
            { name: "–ñ–µ–ª–µ–∑–Ω—ã–π –°–ª–∏—Ç–æ–∫", icon: "‚õìÔ∏è", price: 50, description: "–ë–∞–∑–æ–≤—ã–π —Ä–µ—Å—É—Ä—Å –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞", rarity: "common" },
            { name: "–£–≥–æ–ª—å", icon: "‚ö´", price: 30, description: "–¢–æ–ø–ª–∏–≤–æ –∏ –∫—Ä–∞—Å–∏—Ç–µ–ª—å", rarity: "common" },
            { name: "–Ø–±–ª–æ–∫–æ", icon: "üçé", price: 40, description: "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≥–æ–ª–æ–¥", rarity: "common" },
            { name: "–•–ª–µ–±", icon: "üçû", price: 45, description: "–•–æ—Ä–æ—à–∞—è –µ–¥–∞", rarity: "common" },
            { name: "–ó–æ–ª–æ—Ç–æ–π –°–ª–∏—Ç–æ–∫", icon: "üü®", price: 80, description: "–†–µ–¥–∫–∏–π —Ä–µ—Å—É—Ä—Å", rarity: "common" },
            { name: "–î—É–±–æ–≤—ã–µ –î–æ—Å–∫–∏", icon: "ü™µ", price: 20, description: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª", rarity: "common" },
            { name: "–ö–∞–º–µ–Ω—å", icon: "ü™®", price: 25, description: "–ü—Ä–æ—á–Ω—ã–π –±–ª–æ–∫", rarity: "common" },
            { name: "–ü–∞–ª–∫–∞", icon: "„Ä∞Ô∏è", price: 10, description: "–î–ª—è –∫—Ä–∞—Ñ—Ç–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤", rarity: "common" }
        ],
        uncommon: [
            { name: "–ê–ª–º–∞–∑", icon: "üíé", price: 150, description: "–¶–µ–Ω–Ω—ã–π –º–∏–Ω–µ—Ä–∞–ª", rarity: "uncommon" },
            { name: "–ò–∑—É–º—Ä—É–¥", icon: "üü©", price: 200, description: "–¢–æ—Ä–≥–æ–≤–∞—è –≤–∞–ª—é—Ç–∞", rarity: "uncommon" },
            { name: "–ñ–µ–ª–µ–∑–Ω–∞—è –ö–∏—Ä–∞—Å–∞", icon: "üõ°Ô∏è", price: 180, description: "–ó–∞—â–∏—Ç–∞ –æ—Ç —É—Ä–æ–Ω–∞", rarity: "uncommon" },
            { name: "–ê–ª–º–∞–∑–Ω—ã–π –ú–µ—á", icon: "‚öîÔ∏è", price: 250, description: "–ú–æ—â–Ω–æ–µ –æ—Ä—É–∂–∏–µ", rarity: "uncommon" },
            { name: "–õ—É–∫", icon: "üèπ", price: 120, description: "–î–∞–ª—å–Ω–æ–±–æ–π–Ω–æ–µ –æ—Ä—É–∂–∏–µ", rarity: "uncommon" },
            { name: "–ê–ª–º–∞–∑–Ω–∞—è –ö–∏—Ä–∫–∞", icon: "‚õèÔ∏è", price: 220, description: "–ë—ã—Å—Ç—Ä–∞—è –¥–æ–±—ã—á–∞", rarity: "uncommon" },
            { name: "–ó–æ–ª–æ—Ç–æ–µ –Ø–±–ª–æ–∫–æ", icon: "üçè", price: 160, description: "–ú–æ—â–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ", rarity: "uncommon" },
            { name: "–û–∫–æ –≠–Ω–¥–µ—Ä–∞", icon: "üëÅÔ∏è", price: 300, description: "–î–ª—è –ø–æ–∏—Å–∫–∞ –∫—Ä–µ–ø–æ—Å—Ç–∏", rarity: "uncommon" }
        ],
        rare: [
            { name: "–ù–µ–∑–µ—Ä–∏—Ç–æ–≤—ã–π –°–ª–∏—Ç–æ–∫", icon: "üî±", price: 500, description: "–≠–ª–∏—Ç–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª", rarity: "rare" },
            { name: "–ö–∏—Ä–æ–∫—Ä—ã–ª–æ", icon: "ü™∂", price: 600, description: "–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ", rarity: "rare" },
            { name: "–≠–ª–∏—Ç—Ä–∞", icon: "üß•", price: 800, description: "–ü–æ–ª–µ—Ç—ã –≤ –º–∏—Ä–µ", rarity: "rare" },
            { name: "–ó–æ–ª–æ—Ç–æ–µ –Ø–±–ª–æ–∫–æ", icon: "üçè", price: 400, description: "–û—Å–æ–±–æ–µ –∑–µ–ª—å–µ", rarity: "rare" },
            { name: "–ó–∞—á–∞—Ä–æ–≤–∞–Ω–Ω–∞—è –ö–Ω–∏–≥–∞", icon: "üìö", price: 350, description: "–ú–æ—â–Ω—ã–µ —á–∞—Ä—ã", rarity: "rare" },
            { name: "–ü–ª–∞—â –ù–µ–≤–∏–¥–∏–º–æ—Å—Ç–∏", icon: "üëª", price: 700, description: "–°—Ç–∞—Ç—å –Ω–µ–≤–∏–¥–∏–º—ã–º", rarity: "rare" },
            { name: "–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –õ—É–∫", icon: "üèπ", price: 450, description: "–ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å—Ç—Ä–µ–ª", rarity: "rare" }
        ],
        epic: [
            { name: "–¢–æ—Ç–µ–º –ë–µ—Å—Å–º–µ—Ä—Ç–∏—è", icon: "üê¶", price: 1000, description: "–°–ø–∞—Å–µ–Ω–∏–µ –æ—Ç —Å–º–µ—Ä—Ç–∏", rarity: "epic" },
            { name: "–°–µ—Ä–¥—Ü–µ –ú–æ—Ä—è", icon: "üíô", price: 1200, description: "–†–µ–¥–∫–∞—è —Ä–µ–ª–∏–∫–≤–∏—è", rarity: "epic" },
            { name: "–ì–æ–ª–æ–≤–∞ –î—Ä–∞–∫–æ–Ω–∞", icon: "üê≤", price: 1500, description: "–¢—Ä–æ—Ñ–µ–π –¥—Ä–∞–∫–æ–Ω–∞", rarity: "epic" },
            { name: "–ö—Ä–∏—Å—Ç–∞–ª–ª –≠–Ω–¥–∞", icon: "üíé", price: 900, description: "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥—Ä–∞–∫–æ–Ω–∞", rarity: "epic" },
            { name: "–î—Ä–∞–∫–æ–Ω—å–µ –Ø–π—Ü–æ", icon: "ü•ö", price: 2000, description: "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç—Ä–æ—Ñ–µ–π", rarity: "epic" },
            { name: "–ó–∞—á–∞—Ä–æ–≤–∞–Ω–Ω—ã–π –ó–æ–ª–æ—Ç–æ–π –ú–µ—á", icon: "üó°Ô∏è", price: 1100, description: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ –æ—Ä—É–∂–∏–µ", rarity: "epic" }
        ],
        legendary: [
            { name: "–ö–æ–º–∞–Ω–¥–Ω—ã–π –ë–ª–æ–∫", icon: "üü™", price: 5000, description: "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç", rarity: "legendary" },
            { name: "–ú–µ—á –ù–µ–∑–µ—Ä–∞", icon: "üó°Ô∏è", price: 3000, description: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ –æ—Ä—É–∂–∏–µ", rarity: "legendary" },
            { name: "–ö–æ—Ä–æ–Ω–∞ –í–ª–∞—Å—Ç–∏", icon: "üëë", price: 10000, description: "–ó–Ω–∞–∫ –∞–±—Å–æ–ª—é—Ç–Ω–æ–π –≤–ª–∞—Å—Ç–∏", rarity: "legendary" },
            { name: "–ê—Ä—Ç–µ—Ñ–∞–∫—Ç –°–æ–∑–¥–∞—Ç–µ–ª—è", icon: "‚≠ê", price: 7500, description: "–°–∏–ª–∞ —Ç–≤–æ—Ä–µ–Ω–∏—è", rarity: "legendary" },
            { name: "–°—Ñ–µ—Ä–∞ –ë–µ—Å—Å–º–µ—Ä—Ç–∏—è", icon: "üîÆ", price: 6000, description: "–í–µ—á–Ω–∞—è –∂–∏–∑–Ω—å", rarity: "legendary" }
        ]
    };
    
    const totalWeight = Object.values(currentCase.rarityWeights).reduce((a, b) => a + b, 0);
    let randomWeight = Math.random() * totalWeight;
    
    let selectedRarity = 'common';
    for (const [rarity, weight] of Object.entries(currentCase.rarityWeights)) {
        randomWeight -= weight;
        if (randomWeight <= 0) {
            selectedRarity = rarity;
            break;
        }
    }
    
    const items = minecraftItems[selectedRarity] || minecraftItems.common;
    const randomItem = {...items[Math.floor(Math.random() * items.length)]};
    
    return randomItem;
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
function renderInventory() {
    elements.inventoryGrid.innerHTML = '';
    
    if (inventoryData.length === 0) {
        elements.inventoryGrid.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                <div style="font-size: 3rem; margin-bottom: 20px; animation: float 3s infinite ease-in-out;">üéí</div>
                <p style="color: var(--text-secondary); font-size: 1.1rem; margin-bottom: 10px;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –∫–µ–π—Å—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã!
                </p>
            </div>
        `;
        return;
    }
    
    inventoryData.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'inventory-item';
        itemElement.dataset.rarity = item.rarity;
        
        itemElement.innerHTML = `
            <div class="item-icon">${item.icon}</div>
            <h4>${item.name}</h4>
            <span class="item-rarity ${item.rarity}">${getRarityText(item.rarity)}</span>
            <p style="font-size: 0.8rem; color: var(--accent-diamond); margin-top: 5px;">
                üíé ${item.price}
            </p>
        `;
        
        elements.inventoryGrid.appendChild(itemElement);
    });
}

// –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
function showResult(item) {
    elements.resultItemName.textContent = item.name;
    elements.resultItemRarity.textContent = getRarityText(item.rarity);
    elements.resultItemRarity.className = `item-rarity ${item.rarity}`;
    elements.resultItemPrice.textContent = item.price.toLocaleString();
    elements.resultItemIcon.textContent = item.icon;
    elements.newBalance.textContent = userData.balance.toLocaleString();
    
    hideModal(elements.caseModal);
    showModal(elements.resultModal);
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ä–µ–¥–∫–æ—Å—Ç–∏
function getRarityText(rarity) {
    const rarityMap = {
        'common': '–û–±—ã—á–Ω—ã–π',
        'uncommon': '–ù–µ–æ–±—ã—á–Ω—ã–π',
        'rare': '–†–µ–¥–∫–∏–π',
        'epic': '–≠–ø–∏—á–µ—Å–∫–∏–π',
        'legendary': '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π'
    };
    return rarityMap[rarity] || rarity;
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
function showModal(modal) {
    if (!modal) return;
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function hideModal(modal) {
    if (!modal) return;
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

function showLoading() {
    if (elements.loadingOverlay) {
        elements.loadingOverlay.style.display = 'flex';
        setTimeout(() => {
            elements.loadingOverlay.style.opacity = '1';
        }, 10);
    }
}

function hideLoading() {
    if (elements.loadingOverlay) {
        elements.loadingOverlay.style.opacity = '0';
        setTimeout(() => {
            elements.loadingOverlay.style.display = 'none';
        }, 300);
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
function initEventListeners() {
    if (elements.inventoryBtn) {
        elements.inventoryBtn.addEventListener('click', () => {
            renderInventory();
            showModal(elements.inventoryModal);
        });
    }
    
    if (elements.closeModal) {
        elements.closeModal.addEventListener('click', () => hideModal(elements.caseModal));
    }
    
    if (elements.closeInventory) {
        elements.closeInventory.addEventListener('click', () => hideModal(elements.inventoryModal));
    }
    
    if (elements.closeResult) {
        elements.closeResult.addEventListener('click', () => hideModal(elements.resultModal));
    }
    
    if (elements.openCaseBtn) {
        elements.openCaseBtn.addEventListener('click', openCase);
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
    window.addEventListener('beforeunload', () => {
        if (isInitialized) {
            console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º...');
            saveUserDataToLocal();
            
            if (tg && userData.userId) {
                // –ü—ã—Ç–∞–µ–º—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
                const syncData = {
                    action: 'sync_user_data',
                    data: {
                        balance: userData.balance,
                        inventory: inventoryData,
                        userId: userData.userId,
                        username: userData.username
                    },
                    timestamp: Date.now()
                };
                
                try {
                    tg.sendData(JSON.stringify(syncData));
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏:', error);
                }
            }
        }
    });
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Telegram
if (tg) {
    tg.onEvent('webAppDataReceived', (data) => {
        try {
            console.log('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram:', data);
            
            if (typeof data === 'string') {
                const parsedData = JSON.parse(data);
                
                if (parsedData.success && parsedData.user) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å —Å —Å–µ—Ä–≤–µ—Ä–∞
                    userData.balance = parsedData.user.balance || userData.balance;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                    if (parsedData.inventory && parsedData.inventory.length > 0) {
                        inventoryData = parsedData.inventory;
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                    saveUserDataToLocal();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    updateUI();
                    
                    console.log('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞');
                }
            }
        } catch (error) {
            console.error('Error parsing web app data:', error);
        }
    });
    
    tg.onEvent('closing', () => {
        console.log('–ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ...');
        saveUserDataToLocal();
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...');
    
    initApp();
    initEventListeners();
    
    console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ');
});